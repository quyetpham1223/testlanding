LadiPageScript.const.DATA_TYPE={default:"default",dataset:"dataset"},LadiPageScript.const.DATASET_TYPE={notify:"NOTIFY",spin_lucky:"SPIN_LUCKY",collection:"COLLECTION",blog:"BLOG"},LadiPageScript.const.DATASET_FIELD_TYPE={text:"TEXT",number:"NUMBER",boolean:"BOOLEAN",image:"IMAGE",link:"LINK",html:"HTML",date_time:"DATE_TIME"},LadiPageScript.const.DATASET_ID_LENGTH=24,LadiPageScriptV2.prototype.loadDataset=function(t,e,a,i,n,r,o,s){var d=this,u=function(t,e,a){return!d.isArray(t)||d.isEmpty(e)||d.isEmpty(a)||t.sort(function(t,i){return d.const.SORT_BY_TYPE.asc==a?t[e]>i[e]?1:-1:t[e]<i[e]?1:-1}),t};if(d.runtime.tmp.dataset_check_load)d.runtime.tmp.timeout_dataset_data[e]=d.runTimeout(function(){d.loadDataset(t,e,a,i,n,!1,o,s)},100);else{var m=[],_=[];if(d.isEmpty(t)){Object.keys(d.runtime.eventData).forEach(function(t){var e=d.runtime.eventData[t];d.isEmpty(e["option.data_setting.value"])||(m.push({element_id:t,id:e["option.data_setting.value"],type:e["option.data_setting.type_dataset"],sort_name:e["option.data_setting.sort_name"],sort_by:e["option.data_setting.sort_by"]}),_.push(e["option.data_setting.value"]))}),_=_.unique()}else{if(e.length!=d.const.DATASET_ID_LENGTH)return;if(!d.isNull(d.runtime.tmp.dataset_data[e]))return!0===d.runtime.tmp.dataset_data[e]?void(d.runtime.tmp.timeout_dataset_data[e]=d.runTimeout(function(){d.loadDataset(t,e,a,i,n,!1,o,s)},100)):(!r&&d.isFunction(s)&&s(u(d.runtime.tmp.dataset_data[e],i,n)),u(d.runtime.tmp.dataset_data[e],i,n));d.runtime.tmp.dataset_data[e]=!0,m=[{element_id:t,id:e,type:a,sort_name:i,sort_by:n}],_=[e]}if(0!=_.length){var c=function(t){var e=[];return t.forEach(function(t){e.push({gsx$title:{$t:t.title},gsx$content:{$t:t.content},gsx$time:{$t:t.time},gsx$image:{$t:t.image}})}),e},p=function(t){var e=[];return t.forEach(function(t){var a=[t.coupon_code,t.coupon_text,t.percent+"%"].join("|");a=Base64.encode(a),e.push(a)}),e},l=function(t){return t},T=o?d.runtime.store_id:LadiPage.getRootScope().getStoreId(),g=d.const.API_DATASET_DATA.format(T,_.join(","));d.runtime.tmp.dataset_check_load=!0,d.sendRequest("GET",g,null,!0,null,function(a,i,n){if(n.readyState==XMLHttpRequest.DONE){try{var r=JSON.parse(a);Object.keys(r).forEach(function(t){for(var e=0;e<m.length;e++)m[e].id==t&&(m[e].type==d.const.DATASET_TYPE.notify&&(m[e].dataset=c(r[t])),m[e].type==d.const.DATASET_TYPE.spin_lucky&&(m[e].dataset=p(r[t])),m[e].type==d.const.DATASET_TYPE.blog&&(m[e].dataset=r[t]),m[e].type==d.const.DATASET_TYPE.collection&&(m[e].dataset=l(r[t])))}),m.forEach(function(a){if(d.isNull(a.dataset))return d.runtime.tmp.dataset_data[a.id]=!1,void(d.isEmpty(d.runtime.tmp.timeout_dataset_data[e])||(d.removeTimeout(d.runtime.tmp.timeout_dataset_data[e]),delete d.runtime.tmp.timeout_dataset_data[e]));if(d.runtime.tmp.dataset_data[a.id]=a.dataset,d.isEmpty(t)){var i=d.runtime.eventData[a.element_id],n=LadiPageApp[i.type+d.const.APP_RUNTIME_PREFIX];d.isEmpty(n)?"table"==i.type&&function(t,e){var a=document.getElementById(t);if(!d.isEmpty(a)){for(var i=a.getElementsByTagName("tbody")[0],n=[],r={},o=a.querySelectorAll("thead td"),s=0;s<o.length;s++){var u={name:o[s].getAttribute("data-name"),type:o[s].getAttribute("data-type"),is_show:!0};n.push(u),r[u.name]=o[s].getAttribute("data-width")}var m=d.generateTableTbodyDataset(a,n,r,e);i.outerHTML!=m&&(i.outerHTML=m);for(var _=function(t){t.stopPropagation(),lightbox_image(t.target.getAttribute("data-src"))},c=a.querySelectorAll("table td img"),p=0;p<c.length;p++)c[p].addEventListener("click",_)}}(a.element_id,u(a.dataset,a.sort_name,a.sort_by)):((i=d.copy(i)).dataset_value=u(a.dataset,a.sort_name,a.sort_by),n(i,o).run(a.element_id,d.runtime.isDesktop))}else d.isFunction(s)&&s(u(a.dataset,a.sort_name,a.sort_by))})}catch(t){d.runtime.tmp.dataset_data[e]=!1,d.isEmpty(d.runtime.tmp.timeout_dataset_data[e])||(d.removeTimeout(d.runtime.tmp.timeout_dataset_data[e]),delete d.runtime.tmp.timeout_dataset_data[e])}d.runtime.tmp.dataset_check_load=!1}})}}},LadiPageScriptV2.prototype.generateTableTheadDataset=function(t,e){var a="<thead><tr>",i="",n=this;return this.isArray(t)&&(t=t.filter(function(t){return!t.is_delete&&t.is_show})).forEach(function(t){var r=parseFloatLadiPage(e[t.name])||0;r=r>0?r:"",a+='<td data-name="'+t.name+'" data-type="'+t.type+'"'+(n.isEmpty(r)?"":' data-width="'+r+'"')+">"+t.label+"</td>",i+='<col data-name="'+t.name+'" />'}),a+="</tr></thead>",a+="<colgroup>"+i+"</colgroup>"},LadiPageScriptV2.prototype.generateTableTbodyDataset=function(t,e,a,i){var n="<tbody>";function r(t){return(t>=10?"":"0")+t}var o=this;return this.isArray(e)&&(e=e.filter(function(t){return!t.is_delete&&t.is_show}),this.isArray(i)&&i.forEach(function(t){n+="<tr>",e.forEach(function(e){var i=t[e.name];if(o.isEmpty(i))i="";else{if(e.type==o.const.DATASET_FIELD_TYPE.link&&(i='<a href="'+i+'" target="_blank">'+i+"</a>"),e.type==o.const.DATASET_FIELD_TYPE.image){var s=parseFloatLadiPage(a[e.name])||0;s=s>0?s:100,i='<img data-src="'+i+'" src="'+o.getOptimizeImage(i,s,s,!0,!0,!0,!0)+'" />'}if(e.type==o.const.DATASET_FIELD_TYPE.date_time){var d=new Date(i);i=d.getFullYear()+"-"+r(d.getMonth()+1)+"-"+r(d.getDate())+" "+r(d.getHours())+":"+r(d.getMinutes())+":"+r(d.getSeconds())}e.type==o.const.DATASET_FIELD_TYPE.boolean&&(i=i?o.const.LANG.OPTION_TRUE:o.const.LANG.OPTION_FALSE)}n+="<td>"+i+"</td>"}),n+="</tr>"})),n+="</tbody>"},function(){if(LadiPageScript.isArray(LadiPageScript.runtime.list_dataset_load))for(;LadiPageScript.runtime.list_dataset_load.length>0;){var t=LadiPageScript.runtime.list_dataset_load.shift();LadiPageScript.loadDataset(t.element_id,t.dataset_id,t.dataset_type,t.sort_name,t.sort_by,t.isFirst,t.is_client,t.callback)}}();